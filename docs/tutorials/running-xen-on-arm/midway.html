

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Xen Arm with Virtualization Extensions/Midway &mdash; The Xen Project unknown version documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Xen Project
          

          
          </a>

          
            
            
              <div class="version">
                unknown version
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction to Xen</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/architecture.html">Xen Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/features/index.html">Features</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../booting-xen-u-boot.html">Booting Xen from U-Boot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../building-xen-arm.html">Building Xen on Arm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configure-networking.html">Configuring Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reduce-latency.html">Reducing Latency</a></li>
</ul>
<p class="caption"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../how-to/how-xen-boots.html">How Xen Boots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how-to/code-coverage.html">Code Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/microcode-loading.html">Microcode Loading</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference/hypercall-abi.html">Hypercall ABI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/hypercall-abi.html#hypercall-page">Hypercall Page</a></li>
</ul>
<p class="caption"><span class="caption-text">Glossary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>
<p class="caption"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../faq/faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing to the Xen Project</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contribute-xen/contribute-xen.html">Contributing to Xen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute-xen/submit-patch.html">Submitting Patches to Xen</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Xen Project</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Xen Arm with Virtualization Extensions/Midway</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/tutorials/running-xen-on-arm/midway.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="xen-arm-with-virtualization-extensions-midway">
<h1>Xen Arm with Virtualization Extensions/Midway<a class="headerlink" href="#xen-arm-with-virtualization-extensions-midway" title="Permalink to this headline">¶</a></h1>
<p>Midway is the codename for the <a class="reference external" href="http://www.calxeda.com/wp-content/uploads/2013/10/Calxeda-ECX2000-PB-Oct20132.pdf">Calxeda ECX-2000</a> based server system, featuring four A-15 cores in a micro-server oriented design.</p>
<div class="section" id="supported-versions">
<h2>Supported Versions<a class="headerlink" href="#supported-versions" title="Permalink to this headline">¶</a></h2>
<p>Though the Xen 4.3 release has some ARM support, it will not run on Midway. Beside the missing platform support there were several deficiencies in the code which prevent the 4.3 base (even with fixes) to run on this machine.</p>
<p>Xen 4.4 supports Midway. There is Midway platform code in Xen, which will be automatically detected and used. To use the earlyprintk feature for early debug output, build Xen with “CONFIG_EARLY_PRINTK=midway”.</p>
<p>On the Linux kernel side you need a version which has all the fixes necessary to fully support Midway in LPAE mode. Kernel 3.12 works pretty well. However you should use the latest available version if possible to get the full support, including SWIOTLB. Configure a multi-platform kernel with support for the Calxeda SoCs, LPAE and at least the xgmac network driver as well as the Highbank SATA driver.</p>
</div>
<div class="section" id="booting-xen">
<h2>Booting Xen<a class="headerlink" href="#booting-xen" title="Permalink to this headline">¶</a></h2>
<p>The Calxeda primary firmware switches all cores into HYP mode already and installs a PSCI handler in secure state. Then it launches u-boot, which runs completely in HYP mode. So booting Xen works out of the box. The device tree is included in the firmware flash, this will be adjusted by primary firmware to match the runtime configuration (namely the memory size and parameters). There is no need to explicitly load a device tree, and you should avoid doing that.</p>
<p>To load the Xen binaries, you should load the Xen hypervisor at the address usually used for the (bare-metal) Linux kernel:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>==&gt; tftp $kernel_addr_r xen-4.4
</pre></div>
</div>
<p>Now tell u-boot where the device tree has been loaded and add the Xen command line:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>==&gt; fdt addr $fdt_addr; fdt resize
==&gt; fdt set /chosen xen,xen-bootargs &quot;console=dtuart dtuart=/soc/serial@fff36000&quot;
</pre></div>
</div>
<p>Add any additionally needed Xen command line parameters here (like dom0_mem), if required.</p>
<p>The Dom0 zImage kernel should be loaded at any address supported by Xen, the recommendation is to use 0x1000000 (16MB):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>==&gt; setenv dom0_addr 0x1000000
==&gt; tftp $dom0_addr vmlinuz-3.13-rc3-xen
</pre></div>
</div>
<p>To tell Xen about the location of the Dom0 kernel, we will have to add a subnode to the /chosen node in the in-memory device tree:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>==&gt; fdt mknod /chosen module
==&gt; fdt set /chosen/module compatible &quot;xen,linux-zimage&quot; &quot;xen,multiboot-module&quot;
==&gt; fdt set /chosen/module reg &lt;0x0 $dom0_addr 0x0 0x$filesize&gt;
==&gt; fdt set /chosen/module bootargs &quot;console=hvc0 root=/dev/sda2&quot;
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>$filesize reflects the file size of the last loaded file in u-boot, so subsequent ext2load/fatload/tftp commands will overwrite this value. So make sure to execute these lines right after the Dom0 kernel load.</p>
</div>
<p>Now you can launch Xen:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>==&gt; bootz $kernel_addr_r - $fdt_addr
</pre></div>
</div>
</div>
<div class="section" id="using-network-in-a-guest">
<h2>Using Network in a Guest<a class="headerlink" href="#using-network-in-a-guest" title="Permalink to this headline">¶</a></h2>
<p>The Calxeda firmware needs to know the mac address of the guest, if it plans to use network. Before creating a guest, the following command should be called:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bridge fdb add xx:xx:xx:xx:xx:xx dev eth0
</pre></div>
</div>
<p>This can be automated by dropping the following into <cite>/etc/xen/scripts/vif-post.d/cxfabric.hook</cite> (the .hook suffix is important and the file must be executable):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># (De)register the new device with the CX Fabric. Ignore errors from bridge fdb
# since the MAC might already be present etc.
cxfabric() {
    local command=$1
    local mac=$(xenstore_read &quot;$XENBUS_PATH/mac&quot;)
    case $command in
    online|add)
        log debug &quot;Adding $mac to CXFabric fdb&quot;
        do_without_error bridge fdb add $mac dev eth0
        ;;
    offline)
        log debug &quot;Removing $mac from CXFabric fdb&quot;
        do_without_error bridge fdb del $mac dev eth0
        ;;
    esac
}
cxfabric $command
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The binary bridge is provided by the iproute2 package. On Debian, the package only exists on Jessie and onwards.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, The Xen development community.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>